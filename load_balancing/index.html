
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ixpantia.github.io/faucet/load_balancing/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.8">
    
    
      
        <title>Load Balancing Strategies in Faucet - faucet</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="faucet" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#load-balancing-strategies-in-faucet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="faucet" class="md-header__button md-logo" aria-label="faucet" data-md-component="logo">
      
  <img src="../figures/faucet.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            faucet
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Load Balancing Strategies in Faucet
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../es/load_balancing/" hreflang="es" class="md-select__link">
              Espa√±ol
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ixpantia/faucet" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="faucet" class="md-nav__button md-logo" aria-label="faucet" data-md-component="logo">
      
  <img src="../figures/faucet.png" alt="logo">

    </a>
    faucet
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ixpantia/faucet" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Options
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../router/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Router Mode
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../in_containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    faucet in Containers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../reverse_proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    With Reverse Proxy
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../telemetry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Telemetry
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#default-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Default Strategies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-features-worker-health-and-retries" class="md-nav__link">
    <span class="md-ellipsis">
      Common Features: Worker Health and Retries
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-round-robin" class="md-nav__link">
    <span class="md-ellipsis">
      1. Round Robin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Round Robin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pros" class="md-nav__link">
    <span class="md-ellipsis">
      Pros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cons" class="md-nav__link">
    <span class="md-ellipsis">
      Cons
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ip-hash" class="md-nav__link">
    <span class="md-ellipsis">
      2. IP Hash
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. IP Hash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_1" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases_1" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pros_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cons_1" class="md-nav__link">
    <span class="md-ellipsis">
      Cons
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-cookie-hash" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cookie Hash
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Cookie Hash">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description_2" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases_2" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pros_2" class="md-nav__link">
    <span class="md-ellipsis">
      Pros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cons_2" class="md-nav__link">
    <span class="md-ellipsis">
      Cons
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="load-balancing-strategies-in-faucet">Load Balancing Strategies in Faucet</h1>
<p>Load balancing is a critical component for distributing network traffic across multiple Faucet worker processes, each typically running an instance of an R application (like Shiny, Plumber, or Quarto Shiny). This distribution ensures that no single worker becomes overwhelmed, leading to improved responsiveness, availability, and reliability of your deployed applications. This document outlines the load balancing strategies available in Faucet, their use cases, and their respective advantages and disadvantages.</p>
<p>Faucet allows you to configure the load balancing strategy using the <code>--strategy</code> command-line option or the <code>FAUCET_STRATEGY</code> environment variable. The available strategies are:</p>
<ul>
<li>Round Robin</li>
<li>IP Hash</li>
<li>Cookie Hash</li>
</ul>
<h2 id="default-strategies">Default Strategies</h2>
<p>Faucet applies default strategies based on the application type if not explicitly specified:
*   <strong>Shiny and Quarto Shiny applications:</strong> Default to <code>ip-hash</code> to ensure session persistence.
*   <strong>Plumber APIs:</strong> Default to <code>round-robin</code> as they are often stateless.</p>
<h2 id="common-features-worker-health-and-retries">Common Features: Worker Health and Retries</h2>
<p>All load balancing strategies in Faucet incorporate a mechanism to handle offline worker processes. If a selected backend worker is detected as offline:</p>
<ol>
<li>Faucet will log the attempt to connect to the offline worker.</li>
<li>An exponential backoff retry mechanism is employed.</li>
<li><strong>Behavior upon worker failure differs by strategy:</strong><ul>
<li><strong>Round Robin:</strong> After a short wait (<code>WAIT_TIME_UNTIL_RETRY</code>), Faucet will attempt to route the request to the <em>next available</em> worker in the sequence.</li>
<li><strong>IP Hash &amp; Cookie Hash:</strong> Faucet will continue to retry connecting to the <em>originally designated</em> worker. This means requests for that specific worker are effectively "held" and will experience latency or appear to hang until the worker is back online or the request times out. Clients are not automatically rerouted to a different worker because that would break session persistence.</li>
</ul>
</li>
</ol>
<h2 id="1-round-robin">1. Round Robin</h2>
<h3 id="description">Description</h3>
<p>The Round Robin strategy distributes incoming requests to Faucet's worker processes in a sequential order. Each new request is sent to the next worker in the list. When the end of the list is reached, the load balancer returns to the beginning and starts over.</p>
<h3 id="use-cases">Use Cases</h3>
<ul>
<li><strong>Stateless Applications:</strong> Ideal for stateless applications like many Plumber APIs, where each request can be handled independently by any worker.</li>
<li><strong>Simple Deployments:</strong> Suitable when all worker processes are expected to have similar processing capabilities.</li>
</ul>
<h3 id="pros">Pros</h3>
<ul>
<li><strong>Simplicity:</strong> Easy to understand and implement.</li>
<li><strong>Even Distribution (ideal conditions):</strong> If all workers are healthy and have similar capacities, Round Robin can distribute traffic relatively evenly.</li>
<li><strong>Low Overhead:</strong> Minimal computational cost for the load balancer.</li>
<li><strong>Resilience to Worker Failure:</strong> If a worker goes offline, requests are automatically routed to the next available worker after a brief delay.</li>
</ul>
<h3 id="cons">Cons</h3>
<ul>
<li><strong>Ignores Worker Load:</strong> Does not take into account the current load on individual worker processes (beyond basic online/offline checks).</li>
<li><strong>No Session Persistence:</strong> Clients might be directed to different workers on subsequent requests. This makes it <strong>unsuitable</strong> for stateful applications like Shiny or Quarto Shiny apps that require session stickiness (e.g., maintaining user-specific data or input states).</li>
<li><strong>Uneven Distribution with Varying Capacities:</strong> If worker processes have different underlying capacities (though Faucet typically spawns identical R processes), some might become overloaded.</li>
</ul>
<h2 id="2-ip-hash">2. IP Hash</h2>
<h3 id="description_1">Description</h3>
<p>The IP Hash strategy uses the client's IP address to determine which Faucet worker process will handle the request. A hash function is applied to the client's IP address, and the resulting hash value consistently maps to a specific worker.</p>
<p><strong>Important for Reverse Proxy Setups:</strong> If Faucet is running behind a reverse proxy (e.g., Nginx, Apache), it's crucial to configure the <code>--ip-from</code> option (or <code>FAUCET_IP_FROM</code> environment variable) correctly. This tells Faucet whether to use the direct client IP or an IP from a header like <code>X-Forwarded-For</code> or <code>X-Real-IP</code>, ensuring accurate IP identification for this strategy.</p>
<h3 id="use-cases_1">Use Cases</h3>
<ul>
<li><strong>Stateful Applications (Default for Shiny/Quarto):</strong> Essential for applications like Shiny and Quarto Shiny apps that require session persistence. It ensures that a client is consistently routed to the same worker process, maintaining their session state.</li>
<li><strong>Caching Benefits:</strong> Can improve cache hit rates on the worker if data is cached based on user interactions.</li>
</ul>
<h3 id="pros_1">Pros</h3>
<ul>
<li><strong>Session Persistence:</strong> Guarantees that requests from the same client IP are consistently routed to the same worker, crucial for stateful R applications.</li>
<li><strong>Deterministic Routing:</strong> The same IP will always route to the same worker (assuming the pool of workers hasn't changed).</li>
</ul>
<h3 id="cons_1">Cons</h3>
<ul>
<li><strong>Uneven Load Distribution:</strong><ul>
<li>If a few IP addresses generate a disproportionately large volume of traffic, the workers assigned to those IPs can become overloaded.</li>
<li>Clients behind a Network Address Translation (NAT) gateway or a large corporate proxy will all appear to have the same source IP. All these clients will be directed to the same worker, potentially overwhelming it.</li>
</ul>
</li>
<li><strong>Changing Client IPs:</strong> Session persistence can be lost if a client's IP address changes during their session (e.g., mobile users switching between Wi-Fi and cellular data).</li>
<li><strong>Worker Failures:</strong> If a designated worker goes down, requests for clients hashing to that worker will be held and retried against the <em>same</em> worker, leading to delays for those users until the worker is restored. They are not automatically rerouted to preserve session integrity.</li>
</ul>
<h2 id="3-cookie-hash">3. Cookie Hash</h2>
<h3 id="description_2">Description</h3>
<p>The Cookie Hash strategy achieves session persistence by using an HTTP cookie named <code>FAUCET_LB_COOKIE</code>. When a request arrives:
1.  Faucet checks for the <code>FAUCET_LB_COOKIE</code>.
2.  If the cookie exists and contains a valid UUID, Faucet uses this UUID to consistently select a backend worker process.
3.  If the cookie is not present, is invalid, or the strategy is <code>CookieHash</code> and no suitable cookie UUID is found, <strong>Faucet generates a new UUID</strong>.
4.  This UUID (either extracted or newly generated) is then used to determine the worker.
5.  Crucially, Faucet will <strong>set (or update) the <code>FAUCET_LB_COOKIE</code> in the HTTP response</strong>, including the UUID. This ensures that subsequent requests from the same client browser will include this cookie, directing them to the same worker.</p>
<p>This mechanism ensures the client is consistently directed to the same worker for subsequent requests as long as their browser accepts and sends cookies.</p>
<h3 id="use-cases_2">Use Cases</h3>
<ul>
<li><strong>Robust Stateful Applications:</strong> Provides reliable session persistence for Shiny, Quarto Shiny, or other stateful applications. It's particularly beneficial when client IP addresses are not stable or when many clients might share an IP address (e.g., users behind large NATs or proxies).</li>
<li><strong>Fine-grained Session Control:</strong> Offers more precise control over session stickiness than IP Hash, as it relies on a unique identifier (the cookie's UUID) specific to the client's session, managed by Faucet.</li>
</ul>
<h3 id="pros_2">Pros</h3>
<ul>
<li><strong>Reliable Session Persistence:</strong> More robust than IP Hash in scenarios with dynamic client IPs or NAT, as it depends on the Faucet-managed cookie.</li>
<li><strong>Better Load Distribution (than IP Hash in NAT scenarios):</strong> Can distribute load more evenly than IP Hash when many users share the same source IP, as each user's browser session will get its own <code>FAUCET_LB_COOKIE</code> with a unique UUID.</li>
<li><strong>Deterministic Routing:</strong> The same cookie UUID will consistently route to the same worker (assuming the worker pool is stable).</li>
<li><strong>Automatic Cookie Management by Faucet:</strong> Faucet handles the generation and setting of the necessary cookie, simplifying setup.</li>
</ul>
<h3 id="cons_2">Cons</h3>
<ul>
<li><strong>Client Cookie Support:</strong> Relies on clients accepting and sending cookies. If a client has cookies disabled, this strategy will not provide session persistence.</li>
<li><strong>Cookie Overhead:</strong> Involves the standard overhead of HTTP cookie transmission and processing, though Faucet's management is efficient.</li>
<li><strong>Worker Failures:</strong> Similar to IP Hash, if a worker designated by a cookie hash goes down, requests associated with that cookie hash will be held and retried against the <em>same</em> worker, potentially causing delays for affected users.</li>
<li><strong>Initial Simultaneous Requests:</strong> As noted in the Faucet source code, if a browser sends multiple <em>simultaneous</em> initial requests before the first <code>Set-Cookie</code> response is processed and returned by the browser, those initial requests might briefly hit different workers before settling on the one determined by the eventually set cookie. This is a minor edge case for most applications.</li>
</ul>
<hr />
<p>Choosing the right load balancing strategy in Faucet depends heavily on the specific requirements of your R application, particularly its statefulness, and your deployment environment (e.g., standalone vs. behind a reverse proxy). For Shiny and Quarto Shiny apps, <code>ip-hash</code> (default) or <code>cookie-hash</code> are generally recommended. For stateless Plumber APIs, <code>round-robin</code> (default) is often sufficient.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>